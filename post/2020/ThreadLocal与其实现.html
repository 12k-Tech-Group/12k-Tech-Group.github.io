<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>12k Tech Blog - ThreadLocal与其实现</title><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous"/><link rel="stylesheet" href="/css/github-markdown.css"/><link rel="stylesheet" href="/css/highlight.css"/><script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script><script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous"></script><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/556eb87153dc9ca625fe.css" as="style"/><link rel="stylesheet" href="/_next/static/css/556eb87153dc9ca625fe.css"/><link rel="preload" href="/_next/static/css/47b2eccbc2f53b4c5bb6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/47b2eccbc2f53b4c5bb6.css"/><link rel="preload" href="/_next/static/chunks/main-794d8598b5f1f819e70a.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.6c6c2144b5674c37af03.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.c1da88ced54c9ffa7714.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-6b3651ecef8878c0ce3d.js" as="script"/><link rel="preload" href="/_next/static/chunks/99a17ff61bb56832986f97369f36a5b6e9c99511.4b656b6a47797cef6e06.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/post/%5B...all%5D-2d583e24f5dfdb34109a.js" as="script"/></head><body><div id="__next"><div><div class="relative bg-white Banner_banner__2vTsv"><div class="white pt6 pb5 Banner_banner_content__1HXXB"><h1 class="mv2 f2">12K Tech Blog</h1><div><a class="dib f6 white no-underline mr2" href="/">HOME</a><a class="dib f6 white no-underline mr2" href="https://github.com/12k-Tech-Group">GITHUB</a></div></div></div><main class="lh-copy"><div class="center mw6 ph4 pv3 bg-white markdown-body Post_markdown_body__1i0dP"><small class="mt1 db ttu o-40 Post_post_header__2ubQL"><span>@<a href="https://github.com/leohawke">leohawke</a> </span><span>@<a href="https://github.com/frederick-vs-ja">frederick-vs-ja</a> </span><time>2020/08/26</time></small><div><h1>ThreadLocal与其实现</h1>
<p><img src="/assets/2020/assets/1598414036_27188.png" alt="图1"></p>
<p>C++ <code>thread_local</code> 及 C <code>_Thread_local</code> 变量（线程局部变量， <em>thread local variables</em> ）相关注记</p>
<ul>
<li>存储所用的空间（线程局部存储， <em>thread local storage</em> ， <em>TLS</em> ）随线程创建而分配，随线程终止而释放。</li>
<li>线程局部变量的初始化在 TLS 分配后、线程函数执行前进行，同样地析构在线程函数退出后、 TLS 释放前执行。初始化顺序类似全局（静态存储期的命名空间/类作用域）变量和函数内的静态存储期变量。</li>
<li>通常实现上，每个线程所拥有的线程局部存储大小及布局均相同，且在编译时确定，而线程局部变量的访问方式是通过编译时确定的偏移加存储于特定寄存器的 TLS 基址（如图）。</li>
</ul>
</div></div></main><footer class="center w5 f6 tc mt4 black"><p><span>© </span><span>2020-<!-- -->2020<!-- --> 12k Tech Blog</span></p></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"ThreadLocal与其实现","date":"2020-08-26T11:50:00.000Z","author":[{"name":"leohawke","link":"https://github.com/leohawke"},{"name":"frederick-vs-ja","link":"https://github.com/frederick-vs-ja"}],"html":"\u003ch1\u003eThreadLocal与其实现\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"/assets/2020/assets/1598414036_27188.png\" alt=\"图1\"\u003e\u003c/p\u003e\n\u003cp\u003eC++ \u003ccode\u003ethread_local\u003c/code\u003e 及 C \u003ccode\u003e_Thread_local\u003c/code\u003e 变量（线程局部变量， \u003cem\u003ethread local variables\u003c/em\u003e ）相关注记\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e存储所用的空间（线程局部存储， \u003cem\u003ethread local storage\u003c/em\u003e ， \u003cem\u003eTLS\u003c/em\u003e ）随线程创建而分配，随线程终止而释放。\u003c/li\u003e\n\u003cli\u003e线程局部变量的初始化在 TLS 分配后、线程函数执行前进行，同样地析构在线程函数退出后、 TLS 释放前执行。初始化顺序类似全局（静态存储期的命名空间/类作用域）变量和函数内的静态存储期变量。\u003c/li\u003e\n\u003cli\u003e通常实现上，每个线程所拥有的线程局部存储大小及布局均相同，且在编译时确定，而线程局部变量的访问方式是通过编译时确定的偏移加存储于特定寄存器的 TLS 基址（如图）。\u003c/li\u003e\n\u003c/ul\u003e\n"},"__N_SSG":true},"page":"/post/[...all]","query":{"all":["2020","ThreadLocal与其实现"]},"buildId":"frA6AQ-lMnHO1fj3aUBzT","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-c30a0338d988282f18a0.js"></script><script src="/_next/static/chunks/main-794d8598b5f1f819e70a.js" async=""></script><script src="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" async=""></script><script src="/_next/static/chunks/framework.6c6c2144b5674c37af03.js" async=""></script><script src="/_next/static/chunks/commons.c1da88ced54c9ffa7714.js" async=""></script><script src="/_next/static/chunks/pages/_app-6b3651ecef8878c0ce3d.js" async=""></script><script src="/_next/static/chunks/99a17ff61bb56832986f97369f36a5b6e9c99511.4b656b6a47797cef6e06.js" async=""></script><script src="/_next/static/chunks/pages/post/%5B...all%5D-2d583e24f5dfdb34109a.js" async=""></script><script src="/_next/static/frA6AQ-lMnHO1fj3aUBzT/_buildManifest.js" async=""></script><script src="/_next/static/frA6AQ-lMnHO1fj3aUBzT/_ssgManifest.js" async=""></script></body></html>